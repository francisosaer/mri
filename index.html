<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Opmeet Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
html { font-size:30px; }
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  max-width:1100px;
  margin:auto;
  padding:16px;
}
h1 { text-align:center; font-size:2.6rem; }

.card, .element {
  background:#fff;
  border-radius:14px;
  padding:18px;
  margin-bottom:20px;
  box-shadow:0 3px 8px rgba(0,0,0,.15);
}

label { font-weight:bold; display:block; margin-top:14px; }
input {
  width:100%;
  font-size:1.6rem;
  padding:14px;
  margin-top:6px;
}

.element-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.remove-element {
  width:56px;
  height:56px;
  border:none;
  border-radius:50%;
  background:#f44336;
  display:flex;
  align-items:center;
  justify-content:center;
}

.remove-element svg { fill:white; width:28px; }

.photo-box {
  margin-top:16px;
  padding:16px;
  border:3px dashed #bbb;
  border-radius:14px;
  text-align:center;
}

.camera-btn {
  font-size:90px;
  cursor:pointer;
}

.photo-wrapper {
  position:relative;
  margin-top:14px;
}

.photo-wrapper img {
  width:100%;
  border-radius:10px;
}

.remove-photo {
  position:absolute;
  top:8px;
  right:8px;
  background:rgba(244,67,54,.9);
  color:white;
  border:none;
  width:34px;
  height:34px;
  border-radius:50%;
  font-size:20px;
}

button {
  width:100%;
  padding:20px;
  font-size:1.8rem;
  border:none;
  border-radius:14px;
  margin-top:10px;
}

.primary { background:#2c7be5; color:white; }

.add-options {
  display:flex;
  gap:10px;
}

.add-options button { flex:1; }

.actions {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
</style>
</head>

<body>

<h1>Opmeet Tool</h1>

<div class="card">
  <label>Klantnaam</label>
  <input id="clientName">
  <label>Datum</label>
  <input type="date" id="projectDate">
</div>

<button id="addBtn" class="primary">+ Element toevoegen</button>
<div class="add-options" id="options" style="display:none">
  <button data-type="Raam">Raam</button>
  <button data-type="Deur">Deur</button>
  <button data-type="Poort">Poort</button>
</div>

<div id="elements"></div>

<div class="card actions">
  <button onclick="exportPDF()">ðŸ“„ PDF</button>
  <button onclick="newProject()">ðŸ—‘ Nieuw project</button>
</div>

<script>
const container = document.getElementById("elements");
const counters = {Raam:0, Deur:0, Poort:0};

document.getElementById("addBtn").onclick = () => {
  options.style.display = options.style.display === "flex" ? "none" : "flex";
};

document.querySelectorAll("#options button").forEach(b=>{
  b.onclick = ()=> addElement(b.dataset.type);
});

function addElement(type){
  counters[type]++;
  const el = document.createElement("div");
  el.className="element";
  el.innerHTML=`
    <div class="element-header">
      <strong>${type} ${counters[type]}</strong>
      <button class="remove-element">
        <svg viewBox="0 0 24 24">
          <path d="M3 6h18v2H5l1 14h12l1-14H3zm5 4h2v8H8zm6 0h2v8h-2z"/>
        </svg>
      </button>
    </div>

    <label>Breedte (cm)</label>
    <input type="number">
    <label>Hoogte (cm)</label>
    <input type="number">

    <div class="photo-box">
      <div class="camera-btn">ðŸ“·</div>
      <input type="file" accept="image/*" capture="environment" hidden>
      <div class="photos"></div>
    </div>
  `;
  container.appendChild(el);
  el.scrollIntoView({behavior:"smooth"});

  el.querySelector(".remove-element").onclick=()=>{
    el.remove(); autosave();
  };

  el.querySelectorAll("input").forEach(i=> i.oninput=autosave);

  const cam=el.querySelector(".camera-btn");
  const file=el.querySelector("input[type=file]");
  const photos=el.querySelector(".photos");

  cam.onclick=()=>file.click();
  file.onchange=()=>{
    const r=new FileReader();
    r.onload=e=>{
      const img=new Image();
      img.onload=()=>{
        const c=document.createElement("canvas");
        const s=Math.min(800/img.width,1);
        c.width=img.width*s; c.height=img.height*s;
        c.getContext("2d").drawImage(img,0,0,c.width,c.height);

        const wrap=document.createElement("div");
        wrap.className="photo-wrapper";
        wrap.innerHTML=`
          <img src="${c.toDataURL("image/jpeg",0.6)}">
          <button class="remove-photo">âœ–</button>
        `;
        wrap.querySelector("button").onclick=()=>{wrap.remove(); autosave();}
        photos.appendChild(wrap);
        autosave();
      };
      img.src=e.target.result;
    };
    r.readAsDataURL(file.files[0]);
  };
  autosave();
}

function autosave(){
  const data={klant:clientName.value, datum:projectDate.value, elementen:[]};
  document.querySelectorAll(".element").forEach(el=>{
    data.elementen.push({
      titel:el.querySelector("strong").innerText,
      b:el.querySelectorAll("input")[0].value,
      h:el.querySelectorAll("input")[1].value,
      fotos:[...el.querySelectorAll("img")].map(i=>i.src)
    });
  });
  localStorage.setItem("autosave",JSON.stringify(data));
}

(function restore(){
  const s=localStorage.getItem("autosave");
  if(!s) return;
  const d=JSON.parse(s);
  clientName.value=d.klant;
  projectDate.value=d.datum;
  d.elementen.forEach(e=>{
    addElement(e.titel.split(" ")[0]);
    const el=container.lastChild;
    el.querySelectorAll("input")[0].value=e.b;
    el.querySelectorAll("input")[1].value=e.h;
    const p=el.querySelector(".photos");
    e.fotos.forEach(src=>{
      const w=document.createElement("div");
      w.className="photo-wrapper";
      w.innerHTML=`<img src="${src}"><button class="remove-photo">âœ–</button>`;
      w.querySelector("button").onclick=()=>{w.remove(); autosave();}
      p.appendChild(w);
    });
  });
})();

function newProject(){
  if(confirm("Nieuw project starten?")){
    localStorage.removeItem("autosave");
    location.reload();
  }
}

function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=10;
  pdf.text("Opmeetrapport",10,y); y+=10;
  document.querySelectorAll(".element").forEach(el=>{
    pdf.text(el.querySelector("strong").innerText,10,y); y+=6;
    [...el.querySelectorAll("img")].forEach(img=>{
      pdf.addImage(img.src,"JPEG",10,y,50,35); y+=40;
    });
  });
  pdf.save("opmeting.pdf");
}
</script>

</body>
</html>
